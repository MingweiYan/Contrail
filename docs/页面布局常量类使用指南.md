# 页面布局常量类使用指南

## 1. 系统概述

本文档介绍Contrail应用中新的页面布局常量类系统，该系统通过集中管理布局参数，提高代码可维护性和UI一致性。

### 1.1 系统架构

布局常量系统采用三层架构：

```
BaseLayoutConstants (基础层) ──┐
                              │
+─────────────────────────────+─────────────────────────+
│                             │                         │
AddHabitPageConstants  ProfilePageConstants  ... 其他页面常量类
```

- **BaseLayoutConstants**: 提供所有页面共用的通用布局参数
- **页面特定常量类**: 每个页面有独立的常量类，继承自BaseLayoutConstants，包含页面特有的布局参数
- **PageLayoutConstants**: 保留的兼容层，用于支持未迁移的页面

## 2. 导入与使用

### 2.1 导入方式

```dart
import 'package:contrail/shared/utils/page_layout_constants.dart';
```

### 2.2 基本使用

#### 2.2.1 使用页面特定常量类

```dart
Widget build(BuildContext context) {
  return Container(
    padding: DataBackupPageConstants.containerPadding,
    child: Column(
      children: [
        Text(
          '数据备份',
          style: TextStyle(fontSize: DataBackupPageConstants.fontSize_29),
        ),
        SizedBox(height: DataBackupPageConstants.sectionSpacing),
        // 更多组件...
      ],
    ),
  );
}
```

#### 2.2.2 使用基础常量类

对于通用布局参数，可以直接使用基础常量类：

```dart
Widget build(BuildContext context) {
  return Card(
    borderRadius: BorderRadius.circular(BaseLayoutConstants.borderRadiusMedium),
    margin: EdgeInsets.only(
      bottom: BaseLayoutConstants.spacingMedium,
    ),
    // 其他属性...
  );
}
```

## 3. 常量类命名规范

### 3.1 类命名

- **基础类**: `BaseLayoutConstants`
- **页面类**: `页面名称 + Constants`，如`FullscreenClockPageConstants`, `DataBackupPageConstants`
- **兼容类**: `PageLayoutConstants`

### 3.2 常量命名

常量名称应遵循以下模式：

| 参数类型 | 命名模式 | 示例 |
|---------|---------|------|
| 尺寸 | 功能描述 + 单位 | `containerWidth`, `buttonHeight` |
| 间距 | 位置/用途 + Spacing | `verticalSpacing`, `sectionSpacing` |
| 内边距 | 位置/用途 + Padding | `containerPadding`, `contentPadding` |
| 圆角 | 位置/用途 + BorderRadius | `buttonBorderRadius`, `cardBorderRadius` |
| 字体大小 | fontSize + 数值/描述 | `fontSize_16`, `titleFontSize` |

## 4. 最佳实践

### 4.1 常量类定义

1. **参数组织**：按功能分组组织常量
   ```dart
   class ExamplePageConstants extends BaseLayoutConstants {
     // 容器相关参数
     static final EdgeInsets containerPadding = EdgeInsets.all(ScreenUtil().setWidth(16));
     
     // 按钮相关参数
     static final double buttonHeight = ScreenUtil().setHeight(48);
     
     // 字体大小相关参数
     static final double fontSize_16 = ScreenUtil().setSp(16);
   }
   ```

2. **使用静态常量**：使用`static final`定义常量，避免使用getter方法
   ```dart
   // 推荐
   static final double buttonHeight = ScreenUtil().setHeight(48);
   
   // 不推荐
   static double get buttonHeight => ScreenUtil().setHeight(48);
   ```

3. **描述性命名**：使用有意义的常量名称
   ```dart
   // 推荐
   static final double clockToHintSpacing = ScreenUtil().setHeight(40);
   
   // 不推荐
   static final double height_40 = ScreenUtil().setHeight(40);
   ```

### 4.2 在页面中使用

1. **优先使用页面特定常量**：优先使用页面常量类，而不是直接使用基础类
   ```dart
   // 推荐
   SizedBox(height: DataBackupPageConstants.sectionSpacing);
   
   // 如果页面常量类中没有，再使用基础类
   SizedBox(height: BaseLayoutConstants.spacingLarge);
   ```

2. **避免重复定义**：不创建已有常量的别名

3. **保持一致性**：相同功能的参数使用相同的命名模式

4. **添加注释**：为特殊参数添加注释，说明用途和考量

## 5. 迁移步骤

### 5.1 迁移准备

1. 确保目标页面在`页面布局参数迁移跟踪表.md`中记录
2. 运行迁移辅助工具生成迁移建议
   ```bash
   python3 scripts/layout_migration_helper.py [文件路径]
   ```
3. 在`page_layout_constants.dart`中创建或更新页面常量类

### 5.2 迁移执行

1. 在页面顶部导入常量类
2. 替换所有`ScreenUtil().setWidth()`, `ScreenUtil().setHeight()`, `ScreenUtil().setSp()`调用
3. 移除不再需要的ScreenUtil导入
4. 运行应用，验证布局一致性

### 5.3 迁移完成

1. 更新迁移跟踪表状态
2. 更新迁移日志
3. 进行代码审查

## 6. 迁移示例

### 6.1 迁移前

```dart
Widget build(BuildContext context) {
  return Container(
    padding: EdgeInsets.all(ScreenUtil().setWidth(16)),
    child: Column(
      children: [
        Text(
          '提示文本',
          style: TextStyle(fontSize: ScreenUtil().setSp(24)),
        ),
        SizedBox(height: ScreenUtil().setHeight(40)),
        Text(
          '12:30',
          style: TextStyle(fontSize: ScreenUtil().setSp(120)),
        ),
      ],
    ),
  );
}
```

### 6.2 迁移后

```dart
import 'package:contrail/shared/utils/page_layout_constants.dart';

Widget build(BuildContext context) {
  return Container(
    padding: FullscreenClockPageConstants.containerPadding,
    child: Column(
      children: [
        Text(
          '提示文本',
          style: TextStyle(fontSize: FullscreenClockPageConstants.hintTextFontSize),
        ),
        SizedBox(height: FullscreenClockPageConstants.clockToHintSpacing),
        Text(
          '12:30',
          style: TextStyle(fontSize: FullscreenClockPageConstants.mainClockFontSize),
        ),
      ],
    ),
  );
}
```

## 7. 常见问题解答

### 7.1 常量类中找不到需要的参数怎么办？

**解决方案**：在页面常量类中添加缺失的参数，遵循命名规范。如果该参数可能在其他页面中使用，考虑添加到BaseLayoutConstants中。

### 7.2 如何处理复杂的布局参数计算？

**解决方案**：在常量类中预计算复杂值，避免在页面中进行计算。

```dart
// 在常量类中预计算
static final EdgeInsets complexPadding = EdgeInsets.only(
  left: ScreenUtil().setWidth(16),
  right: ScreenUtil().setWidth(24),
  top: ScreenUtil().setHeight(12),
  bottom: ScreenUtil().setHeight(8),
);
```

### 7.3 如何确保迁移前后布局一致？

**解决方案**：
1. 精确记录原始ScreenUtil调用的值
2. 在常量类中使用完全相同的数值
3. 迁移后进行视觉比对，确保布局没有变化
4. 如果发现不一致，检查常量值是否与原始值完全匹配

### 7.4 如何为新页面创建常量类？

**解决方案**：
1. 参考现有常量类的结构
2. 继承自BaseLayoutConstants
3. 遵循命名规范和组织原则
4. 在迁移跟踪表中记录新页面

## 8. 代码示例

### 8.1 常量类定义示例

```dart
/// 示例页面常量类
class ExamplePageConstants extends BaseLayoutConstants {
  // 容器相关参数
  static final EdgeInsets containerPadding = EdgeInsets.all(ScreenUtil().setWidth(16));
  static final EdgeInsets cardPadding = EdgeInsets.symmetric(
    horizontal: ScreenUtil().setWidth(16),
    vertical: ScreenUtil().setHeight(12),
  );
  
  // 按钮相关参数
  static final double buttonHeight = ScreenUtil().setHeight(48);
  static final double buttonBorderRadius = ScreenUtil().setWidth(8);
  
  // 字体大小相关参数
  static final double titleFontSize = ScreenUtil().setSp(20);
  static final double contentFontSize = ScreenUtil().setSp(16);
  static final double subtitleFontSize = ScreenUtil().setSp(14);
  
  // 间距相关参数
  static final double verticalSpacing = ScreenUtil().setHeight(16);
  static final double horizontalSpacing = ScreenUtil().setWidth(12);
  static final double sectionSpacing = ScreenUtil().setHeight(24);
  
  // 尺寸相关参数
  static final double avatarSize = ScreenUtil().setWidth(48);
  static final double iconSize = ScreenUtil().setWidth(24);
}
```

### 8.2 在页面中使用示例

```dart
import 'package:contrail/shared/utils/page_layout_constants.dart';
import 'package:flutter/material.dart';

class ExamplePage extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: Text('示例页面'),
      ),
      body: Container(
        padding: ExamplePageConstants.containerPadding,
        child: Column(
          crossAxisAlignment: CrossAxisAlignment.start,
          children: [
            // 标题部分
            Text(
              '示例标题',
              style: TextStyle(
                fontSize: ExamplePageConstants.titleFontSize,
                fontWeight: FontWeight.bold,
              ),
            ),
            SizedBox(height: ExamplePageConstants.verticalSpacing),
            
            // 卡片部分
            Card(
              borderRadius: BorderRadius.circular(ExamplePageConstants.buttonBorderRadius),
              margin: EdgeInsets.only(bottom: ExamplePageConstants.verticalSpacing),
              child: Container(
                padding: ExamplePageConstants.cardPadding,
                child: Row(
                  children: [
                    Icon(
                      Icons.info,
                      size: ExamplePageConstants.iconSize,
                    ),
                    SizedBox(width: ExamplePageConstants.horizontalSpacing),
                    Text(
                      '示例内容',
                      style: TextStyle(fontSize: ExamplePageConstants.contentFontSize),
                    ),
                  ],
                ),
              ),
            ),
            
            // 按钮部分
            SizedBox(height: ExamplePageConstants.sectionSpacing),
            ElevatedButton(
              onPressed: () {},
              style: ElevatedButton.styleFrom(
                minimumSize: Size.fromHeight(ExamplePageConstants.buttonHeight),
                shape: RoundedRectangleBorder(
                  borderRadius: BorderRadius.circular(ExamplePageConstants.buttonBorderRadius),
                ),
              ),
              child: Text(
                '提交',
                style: TextStyle(fontSize: ExamplePageConstants.contentFontSize),
              ),
            ),
          ],
        ),
      ),
    );
  }
}
```

## 9. 后续维护

### 9.1 常量更新

1. 所有布局参数的修改都应在常量类中进行
2. 修改前评估影响范围
3. 修改后进行全面的回归测试

### 9.2 文档更新

1. 定期更新迁移跟踪表
2. 维护使用指南和最佳实践
3. 记录常见问题和解决方案

### 9.3 培训与分享

1. 向团队成员介绍新的布局参数系统
2. 分享迁移经验和最佳实践
3. 组织代码审查，确保规范执行

通过遵循本指南，您可以有效地使用和维护Contrail应用中的布局参数系统，提高代码质量和开发效率。