# 页面布局参数统一管理规范

## 1. 概述

### 1.1 背景
当前Contrail应用中的布局参数（如padding、margin、fontSize、borderRadius等）分散在各个页面文件中，大量使用`ScreenUtil().setWidth()`, `ScreenUtil().setHeight()`, `ScreenUtil().setSp()`直接在代码中设置数值。这种方式导致：
- 参数重复定义
- 布局不一致
- 难以统一修改和调整
- 代码维护成本高

### 1.2 目标
- 将所有页面的布局参数统一集中到`page_layout_constants.dart`文件中
- 每个页面使用独立的常量类管理其布局参数
- 保持修改前后页面布局完全一致
- 建立规范的参数管理和使用模式
- 提高代码可维护性和一致性

## 2. 架构设计

### 2.1 常量类层次结构

采用三层常量类架构：

```
BaseLayoutConstants (基础层) ──┐
                              │
+─────────────────────────────+─────────────────────────+
│                             │                         │
AddHabitPageConstants  ProfilePageConstants  ... 其他页面常量类
```

### 2.2 类设计规范

#### 2.2.1 基础类 (BaseLayoutConstants)
- 提供所有页面共用的通用布局参数
- 定义间距、圆角、字体大小等基础值
- 所有页面常量类都继承自此基础类

#### 2.2.2 页面特定类
- 命名格式：`页面名称 + Constants`，如`AddHabitPageConstants`
- 继承自`BaseLayoutConstants`
- 包含该页面特有的所有布局参数
- 参数按功能分组组织

#### 2.2.3 兼容类 (PageLayoutConstants)
- 保留原有API以兼容未迁移的页面
- 提供向后兼容性保障
- 标记为@deprecated，提示使用新的页面特定常量类

### 2.3 文件结构

```dart
// page_layout_constants.dart
import 'package:flutter/material.dart';
import 'package:flutter_screenutil/flutter_screenutil.dart';

// 基础布局常量类
class BaseLayoutConstants {
  // 通用间距、圆角、字体大小等
}

// 页面特定常量类
class AddHabitPageConstants extends BaseLayoutConstants {
  // 添加习惯页面特有的布局参数
}

class ProfilePageConstants extends BaseLayoutConstants {
  // 个人资料页面特有的布局参数
}

// 更多页面常量类...

// 兼容层
class PageLayoutConstants {
  // 原有方法，保持兼容性
}
```

## 3. 命名规范

### 3.1 常量类命名
- **基础类**：`BaseLayoutConstants`
- **页面类**：`页面名称 + Constants`，如`FullscreenClockPageConstants`
- **兼容类**：`PageLayoutConstants`

### 3.2 常量命名

常量名称应遵循以下规范：

| 参数类型 | 命名模式 | 示例 |
|---------|---------|------|
| 尺寸 | 功能描述 + 单位 | `containerWidth`, `titleFontSize` |
| 间距 | 位置 + Spacing | `topSpacing`, `itemSpacing` |
| 内边距 | 位置 + Padding | `containerPadding`, `contentPadding` |
| 外边距 | 位置 + Margin | `sectionMargin`, `cardMargin` |
| 圆角 | 位置 + BorderRadius | `buttonBorderRadius`, `cardBorderRadius` |
| 颜色 | 功能 + Color | `backgroundColor`, `primaryTextColor` |

## 4. 常量定义规范

### 4.1 类型规范
- 尺寸值使用`double`类型
- 边距使用`EdgeInsets`类型
- 圆角使用`double`类型（用于BorderRadius.circular）
- 颜色使用`Color`类型
- 字体样式使用`TextStyle`类型

### 4.2 初始化规范
- 使用`static final`定义计算值（如ScreenUtil调用）
- 使用`static const`定义常量值
- 避免使用getter方法，优先使用直接定义
- 对于复杂计算，在类顶部预计算并缓存

### 4.3 组织规范
在常量类中，参数应按以下顺序组织：
1. 导入语句
2. 类文档注释
3. 容器相关参数（padding, margin, borderRadius）
4. 文本相关参数（fontSize, fontWeight, color）
5. 间距相关参数（各种spacing值）
6. 组件特定参数（按钮尺寸、输入框尺寸等）
7. 动画相关参数（duration, curve等）

## 5. 使用规范

### 5.1 导入方式
```dart
// 正确导入方式
import 'package:contrail/shared/utils/page_layout_constants.dart';
```

### 5.2 使用示例
```dart
Widget build(BuildContext context) {
  return Container(
    padding: AddHabitPageConstants.containerPadding,
    child: Column(
      children: [
        Text(
          '添加习惯',
          style: TextStyle(fontSize: AddHabitPageConstants.titleFontSize),
        ),
        SizedBox(height: AddHabitPageConstants.sectionSpacing),
        // 更多组件...
      ],
    ),
  );
}
```

### 5.3 最佳实践
- **优先使用页面特定常量**，避免直接使用基础类
- **避免重复定义**，不创建已有常量的别名
- **使用描述性命名**，避免使用缩写或简写
- **保持一致性**，相同功能的参数使用相同的命名模式
- **添加注释**，说明参数的用途和特殊考量

## 6. 迁移策略

### 6.1 迁移原则
- **渐进式迁移**：逐个页面迁移，确保每个页面迁移后功能正常
- **精确匹配**：确保迁移后的参数值与原代码完全一致
- **完整记录**：记录每个页面的迁移过程和参数映射关系
- **验证测试**：迁移后进行视觉比对，确保布局不变

### 6.2 迁移流程

1. **准备阶段**
   - 修改`page_layout_constants.dart`文件结构
   - 创建页面常量类模板
   - 设置迁移进度跟踪文档

2. **迁移阶段**
   - 选择一个页面进行分析
   - 提取所有布局参数
   - 在常量类中定义对应参数
   - 替换页面中的直接调用
   - 验证布局一致性

3. **验证阶段**
   - 运行应用
   - 视觉比对迁移前后的页面
   - 测试页面交互功能
   - 确认无布局异常

4. **完成阶段**
   - 记录迁移完成状态
   - 提交代码修改
   - 继续下一个页面

### 6.3 优先级排序

按以下顺序进行迁移：
1. 页面数量较少的模块
2. 功能简单的页面
3. 核心功能页面
4. 复杂页面和组件

### 6.4 迁移检查清单

- [ ] 分析页面中的所有ScreenUtil调用
- [ ] 在对应常量类中定义所有参数
- [ ] 在页面顶部导入常量类
- [ ] 替换所有ScreenUtil调用为常量引用
- [ ] 移除页面中不再需要的ScreenUtil导入
- [ ] 运行应用验证布局一致性
- [ ] 更新迁移跟踪表
- [ ] 创建迁移日志

## 7. 进度跟踪

### 7.1 迁移状态表

创建`页面布局参数迁移跟踪表.md`文件，记录每个页面的迁移状态：

| 页面/组件名称 | 文件路径 | 常量类名称 | 迁移状态 | 迁移日期 | 负责人 | 备注 |
|--------------|---------|-----------|---------|---------|-------|------|
| 添加习惯页面 | lib/features/habit/presentation/pages/add_habit_page.dart | AddHabitPageConstants | 未开始 | - | - | - |
| 习惯管理页面 | lib/features/habit/presentation/pages/habit_management_page.dart | HabitManagementPageConstants | 未开始 | - | - | - |
| 个人资料页面 | lib/features/profile/presentation/pages/profile_page.dart | ProfilePageConstants | 未开始 | - | - | - |
| ... | ... | ... | ... | ... | ... | ... |

### 7.2 迁移日志

为每个页面创建单独的迁移日志文件，记录：
- 原始参数值
- 迁移后的常量映射
- 迁移过程中遇到的问题
- 解决方案

日志文件格式：
```markdown
# [页面名称] 布局参数迁移日志

## 迁移信息
- **文件路径**: [文件路径]
- **常量类**: [常量类名称]
- **迁移日期**: [YYYY-MM-DD]
- **迁移状态**: [未开始/进行中/已完成/已验证]

## 原始参数统计
- **总调用次数**: [数量]

### 唯一参数值
- **WIDTH**: [值列表]
- **HEIGHT**: [值列表]
- **SP**: [值列表]

## 迁移记录
| 替换项 | 原始代码 | 替换后代码 | 状态 |
|-------|---------|-----------|------|
| width: 16 | `ScreenUtil().setWidth(16)` | `XXXConstants.xxx` | 已替换 |
```

## 8. 风险评估与应对

### 8.1 潜在风险

| 风险 | 影响 | 应对措施 |
|------|------|----------|
| 布局参数值不一致 | 页面布局变化 | 精确记录原始值，迁移后进行视觉比对 |
| 常量名称冲突 | 代码错误 | 使用清晰的命名规范，按页面隔离 |
| 遗漏参数 | 部分布局未迁移 | 仔细检查每个文件，确保全覆盖 |
| 依赖问题 | 常量类引用错误 | 统一导入方式，使用相对路径 |
| 编译错误 | 构建失败 | 保留兼容层，确保平稳过渡 |

### 8.2 质量保证

- 建立迁移前后的截图比对流程
- 进行单元测试和集成测试
- 代码审查确保迁移质量
- 增量部署，监控线上反馈
- 使用CI/CD管道验证每次迁移

## 9. 验收标准

### 9.1 功能验收
- 所有页面布局与迁移前完全一致
- 应用可以正常编译和运行
- 无新增的警告或错误

### 9.2 代码验收
- 所有页面的布局参数都已迁移到常量类
- 遵循命名规范和组织规范
- 提供完整的迁移文档和记录
- 通过代码审查

## 10. 后续维护

### 10.1 新增页面
- 为新页面创建对应的常量类
- 遵循本规范的命名和组织原则
- 优先使用基础类中的通用参数

### 10.2 参数修改
- 所有参数修改在常量类中进行
- 记录修改原因和影响范围
- 进行全面的回归测试

### 10.3 文档更新
- 定期更新迁移状态表
- 维护使用指南和最佳实践
- 记录常见问题和解决方案

## 11. 附录

### 11.1 常量类模板

```dart
/// [页面名称]专用布局常量类
class [页面名称]Constants extends BaseLayoutConstants {
  // 容器相关参数
  static final EdgeInsets containerPadding = EdgeInsets.all(ScreenUtil().setWidth(16));
  static final double containerBorderRadius = ScreenUtil().setWidth(12);
  
  // 文本相关参数
  static final double titleFontSize = ScreenUtil().setSp(24);
  static final double contentFontSize = ScreenUtil().setSp(16);
  
  // 间距相关参数
  static final double sectionSpacing = ScreenUtil().setHeight(24);
  static final double itemSpacing = ScreenUtil().setHeight(12);
  
  // 组件特定参数
  // ...
}
```

### 11.2 迁移辅助工具

提供迁移辅助脚本，功能包括：
- 分析文件中的ScreenUtil调用
- 生成迁移建议和替换方案
- 自动创建迁移日志
- 跟踪迁移进度